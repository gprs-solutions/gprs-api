name: ‚úîÔ∏è Health Check 

on:
  # Scheduled trigger every 30 minutes
  schedule:
    - cron: '*/5 * * * *'

jobs:
  run_with_options:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # Define the environments and associated health check URLs
        option: 
          - name: DEV
            url_var: "HEALTH_CHECK_ENDPOINT_DEV"
          - name: PROD
            url_var: "HEALTH_CHECK_ENDPOINT"

    steps:
      - name: ‚úîÔ∏è Check Routes
        id: request
        env:
          HEALTH_CHECK_URL: ${{ secrets[matrix.option.url_var] }}
        run: |
          echo "üîç Checking health endpoint for ${matrix.option.name} at $HEALTH_CHECK_URL"
          
          # Make the HTTP request to the dynamic URL and capture the status code
          STATUS_CODE=$(curl -s -o /dev/null -w "%{http_code}" "$HEALTH_CHECK_URL")

          # Check the status code range and echo color-coded message
          if [[ $STATUS_CODE -ge 200 && $STATUS_CODE -le 299 ]]; then
            echo -e "\033[0;32m‚úÖ Success: Status code $STATUS_CODE\033[0m"
          else
            echo -e "\033[0;31m‚ùå Failure: Status code $STATUS_CODE\033[0m"
          fi

      - name: üìã Set Output Based on Status
        if: steps.request.outputs.status == '200'
        run: echo "üü¢ Request was successful for ${matrix.option.name}"
