name: health-check

on:
  # Only runs on manual trigger
  workflow_dispatch:

jobs:
  run_with_options:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # Define the environments with direct URLs
        option: 
          - name: DEV
            url: "${{ vars.HEALTH_CHECK_ENDPOINT_DEV }}"
          - name: PROD
            url: "${{ vars.HEALTH_CHECK_ENDPOINT }}"

    steps:
      - name: ‚úîÔ∏è Check Routes
        run: |
          echo "Checking health endpoint for ${matrix.option.name} at ${matrix.option.url}"
          
          # Make the HTTP request to the dynamic URL and capture the status code
          STATUS_CODE=$(curl -s -o /dev/null -w "%{http_code}" "${matrix.option.url}")

          # Check the status code range and echo color-coded message
          if [[ $STATUS_CODE -ge 200 && $STATUS_CODE -le 299 ]]; then
            echo -e "\033[0;32m‚úÖ Success: Status code $STATUS_CODE\033[0m"
          else
            echo -e "\033[0;31m‚ùå Failure: Status code $STATUS_CODE\033[0m"
          fi

      - name: üìã Set Output Based on Status
        if: ${{ steps.request.outputs.status == '200' }}
        run: echo "Request was successful for ${matrix.option.name}"