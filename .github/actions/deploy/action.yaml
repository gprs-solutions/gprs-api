name: ðŸš€ Deployment

description: Upload files to FTP server

inputs:
  ftp-server:
    description: 'The FTP server URL'
    required: true
  ftp-user:
    description: 'The FTP username'
    required: true
  ftp-password:
    description: 'The FTP password'
    required: true
  SSH_PRIVATE_KEY:
    description: 'The SSH private key'
    required: true
  SSH_PASSPHRASE:
    description: 'The SSH passphrase'
    required: true
  SSH_USER:
    description: 'The SSH user'
    required: true
  SSH_PASSWORD:
    description: 'The SSH password'
    required: true

runs:
  using: 'composite'
  steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ðŸ“¦ Download build artifacts
      uses: actions/download-artifact@v4
      with:
        name: laravel-build
        path: ./laravel-build/

    - name: enable ssh-rsa
      shell: bash
      run: |
        sudo echo "CASignatureAlgorithms +ssh-rsa" >> /etc/ssh/sshd_config
        sudo systemctl restart sshd

    - name: Set up SSH
      uses: appleboy/ssh-action@v1.1.0
      with:
        host: gprssolutions.com.br
        username: ${{ inputs.SSH_USER }}
        password: ${{ inputs.SSH_PASSWORD }}
        key: ${{ inputs.SSH_PRIVATE_KEY }}
        port: 2222
        use_insecure_cipher: true
        script: |
          whoami
          ls -al
    
    - name: ðŸ”„ Sync code with server
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ${{ inputs.ftp-server }}
        username: ${{ inputs.ftp-user }}
        password: ${{ inputs.ftp-password }}
        local-dir: ./laravel-build/
